import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Bjl2qjEM.js";import{d as l,r as a,ad as t,N as o,s as n,e as i,v as s,B as u,C as r,D as c,G as d,F as p,K as m,H as g,V as f,y as v,o as y,c as h,w as _,a as x,z as w,t as b,A as k,f as S,W as F,I as C,bz as j,E as V,S as E,j as A,J as L,l as z,M as U}from"./index-D9UQcSFE.js";import{a as D,E as B}from"./el-col-CXXou3fy.js";import{E as P}from"./el-text-nFwZ0AHD.js";import{E as T}from"./el-tag-kYKN7H0G.js";import"./el-tooltip-l0sNRNKZ.js";import{E as I}from"./el-popper-CI0yhH6M.js";import{E as R}from"./el-upload-LZeOK5Ti.js";import"./el-progress-DiltV8uQ.js";import{E as H,a as M,b as W}from"./el-dropdown-item-C-MClRcm.js";import{E as N}from"./el-drawer-bw6GB9YA.js";import{E as $}from"./el-space-B2KBkAnB.js";import{E as O}from"./el-switch-B9n_0JFR.js";import{_ as q}from"./Table.vue_vue_type_script_lang-BwmIaq25.js";import{u as G}from"./useTable-CbxTkDDT.js";import{u as J}from"./useIcon-Dp8bmm5Q.js";import{_ as K}from"./Dialog.vue_vue_type_style_index_0_lang-DeqRaDiv.js";import{e as Y,f as Z,h as Q,u as X,r as ee,j as le,k as ae,l as te,c as oe}from"./index-BdT7lvrf.js";import ne from"./detail-BjUg3oZN.js";const ie={class:"flex flex-wrap gap-3 items-center"},se={style:{position:"relative",top:"12px"}},ue={style:{display:"flex","align-items":"center",gap:"16px",width:"100%"}},re={style:{"font-weight":"500","white-space":"nowrap"}},ce={style:{color:"#f56c6c","font-size":"12px","font-weight":"normal","line-height":"1.4"}},de={style:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},pe={style:{"font-weight":"500"}},me={style:{display:"flex","flex-direction":"column",height:"100%"}},ge={style:{padding:"16px",background:"#1e1e1e",color:"#d4d4d4","font-family":"'Consolas', 'Monaco', 'Courier New', monospace","font-size":"13px","line-height":"1.6","min-height":"100%","white-space":"pre-wrap","word-wrap":"break-word"}},fe={key:0},ve=["innerHTML"],ye={key:1},he={key:2,style:{color:"#888","text-align":"center",padding:"40px"}},_e={style:{padding:"16px","border-top":"1px solid var(--el-border-color)",display:"flex","justify-content":"space-between","align-items":"center"}},xe={style:{color:"var(--el-text-color-secondary)","font-size":"12px"}},we={key:0},be={key:1},ke={class:"flex flex-col gap-2"};function Se(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!L(e)}const Fe=l({__name:"ClientPlugin",setup(l,{expose:L}){const Fe=J({icon:"iconoir:search"}),{t:Ce}=z(),je=a(""),Ve=()=>{We()},Ee=t("openMarketDialog",(()=>{})),Ae=t("pendingPluginsCount",a(0)),Le=o((()=>Ae.value)),ze=n([{field:"index",label:Ce("tableDemo.index"),type:"index",minWidth:"15"},{field:"selection",type:"selection",minWidth:55,selectable:e=>!e.isSystem},{field:"name",label:Ce("plugin.name"),formatter:(e,l,a)=>i("a",{href:`https://plugin.scope-sentry.top/plugin/${e.hash}`,style:"color: #409EFF; text-decoration: none;",target:"_blank"},[a])},{field:"module",label:Ce("plugin.module"),formatter:(e,l,a)=>{const t=Ue[a]||"#FFFFFF";return i(T,{style:{backgroundColor:t,color:"#000"}},Se(a)?a:{default:()=>[a]})}},{field:"version",label:Ce("plugin.version"),minWidth:100},{field:"parameter",label:Ce("plugin.parameter"),formatter:(e,l,a)=>i(I,{content:e.help,placement:"top",effect:"light"},{default:()=>[i("span",{style:"cursor: pointer;"},[a])]})},{field:"introduction",label:Ce("plugin.introduction"),minWidth:200},{field:"action",label:Ce("tableDemo.action"),width:450,fixed:"right",formatter:(e,l,a)=>{let t,o,n,m;const g=s(W,{onCommand:l=>{switch(l){case"reinstall":le("all",e.hash,e.module);break;case"recheck":ee("all",e.hash,e.module);break;case"uninstall":X("all",e.hash,e.module)}}},{default:()=>s(u,{style:{outline:"none",boxShadow:"none"}},(()=>[Ce("common.operation"),s(r,{},(()=>s(c)))])),dropdown:()=>s(H,null,(()=>[s(M,{command:"reinstall"},(()=>Ce("plugin.reInstall"))),s(M,{command:"recheck"},(()=>Ce("plugin.reCheck"))),s(M,{command:"uninstall"},(()=>Ce("plugin.uninstall")))]))});return i(p,null,[g,i(d,{type:"warning",style:{marginLeft:"10px"},onClick:()=>hl(e)},Se(t=Ce("common.log"))?t:{default:()=>[t]}),i(d,{type:"info",style:{marginLeft:"10px"},onClick:()=>Ye(e.hash,e.module)},Se(o=Ce("common.cleanLog"))?o:{default:()=>[o]}),i(d,{type:"success",onClick:()=>tl(e.id)},Se(n=Ce("common.edit"))?n:{default:()=>[n]}),i(d,{type:"danger",onClick:()=>Ke(e.hash,e.module),disabled:e.isSystem},Se(m=Ce("common.delete"))?m:{default:()=>[m]})])}}]),Ue={TargetHandler:"#2243dda6",SubdomainScan:"#FF9B85",SubdomainSecurity:"#FFFFBA",PortScanPreparation:"#BAFFB3",PortScan:"#BAE1FF",AssetMapping:"#e3ffba",URLScan:"#D1BAFF",WebCrawler:"#FFABAB",DirScan:"#3ccde6",VulnerabilityScan:"#FF677D",AssetHandle:"#B2E1FF",PortFingerprint:"#ffb5e4",URLSecurity:"#FFE4BA",PassiveScan:"#A2DFF7"},{tableRegister:De,tableState:Be,tableMethods:Pe}=G({fetchDataApi:async()=>{const{currentPage:e,pageSize:l}=Be,a=await ae(je.value,e.value,l.value,"scan");return{list:a.data.list,total:a.data.total}},immediate:!0}),{loading:Te,dataList:Ie,total:Re,currentPage:He,pageSize:Me}=Be;Me.value=20;const{getList:We,getElTableExpose:Ne}=Pe;function $e(){return{background:"var(--el-fill-color-light)"}}const Oe=a(!1);let qe=Ce("plugin.new");const Ge=()=>{Oe.value=!1},Je=async()=>{m({title:"Delete",draggable:!0}).then((async()=>{await el()}))},Ke=async(e,l)=>{m({title:"Delete",draggable:!0}).then((async()=>{await Xe(e,l)}))},Ye=async(e,l)=>{m({title:"Clean Log",message:"Are you sure you want to clean the logs?",draggable:!0}).then((async()=>{await Y(l,e)}))},Ze=async()=>{m({title:"Clean All Plugin Logs",message:"Are you sure you want to clean all plugin logs?",draggable:!0}).then((async()=>{await te()}))},Qe=a(!1),Xe=async(e,l)=>{Qe.value=!0;try{await Z([{hash:e,module:l}]);Qe.value=!1,We()}catch(a){Qe.value=!1,We()}},el=async()=>{const e=await Ne(),l=((null==e?void 0:e.getSelectionRows())||[]).map((e=>({hash:e.hash,module:e.module})));Qe.value=!0;try{await Z(l);Qe.value=!1,We()}catch(a){Qe.value=!1,We()}},ll=async()=>{al.value="",Oe.value=!0},al=a(""),tl=async e=>{al.value=e,qe=Ce("common.edit"),Oe.value=!0},ol=a(!1),nl=a(""),il=async()=>{if(nl.value){200==(await oe(nl.value)).code&&(localStorage.setItem("plugin_key",nl.value),ol.value=!1)}},sl=()=>{nl.value?localStorage.setItem("plugin_key",nl.value):localStorage.removeItem("plugin_key")};g((()=>{rl(),window.addEventListener("resize",rl),(()=>{const e=localStorage.getItem("plugin_key");e||(ol.value=!0),nl.value=e||""})()}));const ul=a(0),rl=()=>{const e=window.innerHeight||document.documentElement.clientHeight;ul.value=.7*e},cl=a(!1),dl=()=>{cl.value=!1,ml.value=""},pl=a(""),ml=a(""),gl=a(),fl=a(!0),vl=a(""),yl=a(""),hl=async e=>{vl.value=e.module,yl.value=e.hash,await _l(),cl.value=!0,setTimeout((()=>{wl()}),100)},_l=async()=>{const e=await Q(vl.value,yl.value);pl.value=e.data.data,fl.value&&setTimeout((()=>{wl()}),50)},xl=async()=>{await Y(vl.value,yl.value),pl.value="",U.success(Ce("common.cleanLog")+" "+Ce("common.success"))},wl=()=>{if(gl.value){const e=gl.value.$el,l=null==e?void 0:e.querySelector(".el-scrollbar__wrap");l&&(l.scrollTop=l.scrollHeight)}},bl=async()=>{if(pl.value)try{await navigator.clipboard.writeText(pl.value),U.success(Ce("common.copySuccess"))}catch(e){U.error(Ce("common.copyFailed"))}},kl=o((()=>{if(!ml.value||!pl.value)return pl.value;const e=ml.value;return pl.value.split("\n").filter((l=>l.toLowerCase().includes(e.toLowerCase()))).join("\n")})),Sl=e=>{if(!ml.value||!e)return e;const l=ml.value,a=new RegExp(`(${l})`,"gi");return e.replace(a,"<mark>$1</mark>")},Fl={Authorization:`${f().getToken}`},Cl=a(),jl=e=>{Cl.value.clearFiles();const l=e[0];Cl.value.handleStart(l)},Vl=e=>{var l;200===e.code?U.success("Upload succes"):U.error(e.message),505==e.code&&localStorage.removeItem("plugin_key"),We(),null==(l=Cl.value)||l.clearFiles()},El=(e,l)=>{l.length>0&&Cl.value.submit()};return L({refreshList:We}),(l,a)=>{const t=v("Icon");return y(),h(p,null,[i(x(e),null,{default:_((()=>[i(x(D),null,{default:_((()=>[i(x(B),{span:1},{default:_((()=>[i(x(P),{class:"mx-1",style:{position:"relative",top:"8px"}},{default:_((()=>[w(b(x(Ce)("plugin.name"))+":",1)])),_:1})])),_:1}),i(x(B),{span:5},{default:_((()=>[i(x(k),{modelValue:je.value,"onUpdate:modelValue":a[0]||(a[0]=e=>je.value=e),placeholder:x(Ce)("common.inputText"),style:{height:"38px"}},null,8,["modelValue","placeholder"])])),_:1}),i(x(B),{span:5,style:{position:"relative",left:"16px"}},{default:_((()=>[i(x(u),{type:"primary",icon:x(Fe),style:{height:"100%"},onClick:Ve},{default:_((()=>[w("Search")])),_:1},8,["icon"])])),_:1}),i(x(B),{span:1,style:{position:"relative",left:"32px"}},{default:_((()=>[i(x(P),{class:"mx-1",style:{position:"relative",top:"8px"}},{default:_((()=>[w(b(x(Ce)("plugin.key"))+":",1)])),_:1})])),_:1}),i(x(B),{span:5,style:{position:"relative",left:"32px"}},{default:_((()=>[i(x(k),{modelValue:nl.value,"onUpdate:modelValue":a[1]||(a[1]=e=>nl.value=e),placeholder:x(Ce)("plugin.key"),style:{height:"38px"},onBlur:sl},null,8,["modelValue","placeholder"])])),_:1})])),_:1}),i(x(D),{gutter:16,class:"mt-4"},{default:_((()=>[i(x(B),{xs:24,sm:24,md:24,lg:24,xl:24},{default:_((()=>[S("div",ie,[i(x(d),{type:"primary",onClick:ll},{default:_((()=>[w(b(x(Ce)("plugin.new")),1)])),_:1}),i(x(d),{type:"danger",loading:Qe.value,onClick:Je},{default:_((()=>[w(b(x(Ce)("plugin.delete")),1)])),_:1},8,["loading"]),i(x(F),{value:Le.value,hidden:0===Le.value,max:99},{default:_((()=>[i(x(d),{type:"success",onClick:x(Ee)},{default:_((()=>[w(b(x(Ce)("plugin.market")),1)])),_:1},8,["onClick"])])),_:1},8,["value","hidden"]),i(x(d),{type:"warning",onClick:Ze},{default:_((()=>[w(b(x(Ce)("common.cleanAllLog")),1)])),_:1}),i(x(R),{ref_key:"upload",ref:Cl,class:"flex items-center",action:"/api/plugin/import?key="+(nl.value||""),headers:Fl,"on-success":Vl,limit:1,"on-exceed":jl,"auto-upload":!1,onChange:El},{trigger:_((()=>[i(x(d),null,{icon:_((()=>[i(t,{icon:"iconoir:upload"})])),default:_((()=>[w(" "+b(x(Ce)("plugin.import")),1)])),_:1})])),_:1},8,["action"])])])),_:1})])),_:1}),S("div",se,[i(x(q),{pageSize:x(Me),"onUpdate:pageSize":a[2]||(a[2]=e=>C(Me)?Me.value=e:null),currentPage:x(He),"onUpdate:currentPage":a[3]||(a[3]=e=>C(He)?He.value=e:null),columns:ze,data:x(Ie),stripe:"",border:!0,loading:x(Te),resizable:!0,pagination:{total:x(Re),pageSizes:[20,30,50,100,200,500,1e3]},onRegister:x(De),headerCellStyle:$e,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","loading","pagination","onRegister"])])])),_:1}),i(x(N),{modelValue:Oe.value,"onUpdate:modelValue":a[4]||(a[4]=e=>Oe.value=e),size:"50%",direction:"rtl"},{title:_((()=>[S("div",ue,[S("span",re,b(x(qe)),1),S("span",ce,b(x(Ce)("plugin.parameterConfigTip")),1)])])),default:_((()=>[i(ne,{closeDialog:Ge,getList:x(We),id:al.value,tp:"scan"},null,8,["getList","id"])])),_:1},8,["modelValue"]),i(x(N),{modelValue:cl.value,"onUpdate:modelValue":a[7]||(a[7]=e=>cl.value=e),title:x(Ce)("node.log"),size:"80%",direction:"rtl","with-header":!0},{header:_((()=>[S("div",de,[S("span",pe,b(x(Ce)("node.log")),1),i(x($),null,{default:_((()=>[i(x(k),{modelValue:ml.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ml.value=e),placeholder:x(Ce)("common.search"),clearable:"",style:{width:"200px"}},{prefix:_((()=>[i(x(r),null,{default:_((()=>[i(x(j))])),_:1})])),_:1},8,["modelValue","placeholder"]),i(x(O),{modelValue:fl.value,"onUpdate:modelValue":a[6]||(a[6]=e=>fl.value=e),"active-text":x(Ce)("common.autoScroll"),"inactive-text":""},null,8,["modelValue","active-text"])])),_:1})])])),default:_((()=>[S("div",me,[i(x(V),{ref_key:"logScrollbarRef",ref:gl,style:{flex:"1",height:"0"}},{default:_((()=>[S("div",ge,[ml.value&&kl.value?(y(),h("div",fe,[(y(!0),h(p,null,E(kl.value.split("\n"),((e,l)=>(y(),h("div",{key:l,innerHTML:Sl(e)},null,8,ve)))),128))])):pl.value?(y(),h("div",ye,b(pl.value),1)):(y(),h("div",he,b(x(Ce)("common.noData")),1))])])),_:1},512),S("div",_e,[S("div",xe,[ml.value?(y(),h("span",we,b(x(Ce)("common.searchResult"))+": "+b(kl.value.split("\n").filter((e=>e)).length)+" "+b(x(Ce)("common.lines")),1)):pl.value?(y(),h("span",be,b(pl.value.split("\n").filter((e=>e)).length)+" "+b(x(Ce)("common.lines")),1)):A("",!0)]),i(x($),null,{default:_((()=>[i(x(d),{onClick:_l,type:"primary"},{default:_((()=>[w(b(x(Ce)("common.refresh")),1)])),_:1}),i(x(d),{onClick:bl,type:"info"},{default:_((()=>[w(b(x(Ce)("common.copy")),1)])),_:1}),i(x(d),{onClick:xl,type:"danger"},{default:_((()=>[w(b(x(Ce)("common.cleanLog")),1)])),_:1}),i(x(d),{onClick:dl},{default:_((()=>[w(b(x(Ce)("common.off")),1)])),_:1})])),_:1})])])])),_:1},8,["modelValue","title"]),i(x(K),{modelValue:ol.value,"onUpdate:modelValue":a[9]||(a[9]=e=>ol.value=e),title:x(Ce)("plugin.key"),center:"",width:"30%",style:{"max-width":"400px",height:"200px"}},{default:_((()=>[S("div",ke,[i(x(I),{class:"item",effect:"dark",content:x(Ce)("plugin.keyMsg"),placement:"top"},{default:_((()=>[i(x(k),{modelValue:nl.value,"onUpdate:modelValue":a[8]||(a[8]=e=>nl.value=e)},null,8,["modelValue"])])),_:1},8,["content"]),i(x(d),{onClick:il,type:"primary",class:"w-full"},{default:_((()=>[w("Save")])),_:1})])])),_:1},8,["modelValue","title"])],64)}}});export{Fe as _};
