import{d as e,r as a,Y as l,M as t,a9 as o,o as u,i as r,w as d,e as n,a as i,A as p,c as s,S as m,F as c,j as v,B as b,X as g,z as y,t as f,f as V,l as h,cy as _,_ as S}from"./index-D9UQcSFE.js";import{a as L,E as C}from"./el-form-ClIvQroC.js";import"./el-tag-kYKN7H0G.js";import{E as U,b as k}from"./el-select-Dv9vCEmJ.js";import"./el-popper-CI0yhH6M.js";import{a as x,E as w}from"./el-col-CXXou3fy.js";import{E as j,a as N}from"./el-tab-pane-CbJd8YfH.js";import{E as $}from"./el-space-B2KBkAnB.js";import{j as P,o as A,T as I}from"./index-r_ORVl1e.js";import{o as z,s as D}from"./index-BdT7lvrf.js";import{g as E,e as F}from"./index-DRPh3UHe.js";import"./castArray-Bow0xsjh.js";import"./strings-CBvC00KA.js";import"./index-BOy3-hgS.js";import"./useInput-DYqoIpgX.js";import"./debounce-CgKOJkOb.js";import"./index-BRGVtAVt.js";const H={style:{padding:"12px",border:"1px solid #dcdfe6","border-radius":"4px"}},T={style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},M={class:"code-editor-container"},R={class:"action-bar"},q=S(e({__name:"detail",props:{closeDialog:{type:Function},getList:{type:Function},id:{},tp:{},hash:{}},setup(e){const{t:S}=h(),q=e,B=a({name:"",version:"",module:"",parameter:"",help:"",introduction:"",source:"",parameterList:[]}),J=()=>{B.value={name:"",version:"",module:"",parameter:"",help:"",introduction:"",source:"",parameterList:[]},K.value=""},O=a({name:[{required:!0,message:"",trigger:"blur"}],module:[{required:"scan"==q.tp,message:"",trigger:"change"}],source:[{required:!0,message:"",trigger:"blur"}]}),W=a([{label:"TargetHandler",value:"TargetHandler"},{label:"SubdomainScan",value:"SubdomainScan"},{label:"SubdomainSecurity",value:"SubdomainSecurity"},{label:"PortScanPreparation",value:"PortScanPreparation"},{label:"PortScan",value:"PortScan"},{label:"AssetMapping",value:"AssetMapping"},{label:"URLScan",value:"URLScan"},{label:"WebCrawler",value:"WebCrawler"},{label:"DirScan",value:"DirScan"},{label:"VulnerabilityScan",value:"VulnerabilityScan"},{label:"AssetHandle",value:"AssetHandle"},{label:"PortFingerprint",value:"PortFingerprint"},{label:"URLSecurity",value:"URLSecurity"},{label:"PassiveScan",value:"PassiveScan"}]),K=a(""),X=[P(),A],Y=a([]),G=a([]),Q=()=>{setTimeout((()=>{const e=(a=B.value.parameterList)&&0!==a.length?a.filter((e=>e&&e.name&&e.type)).map((e=>"dict"===e.type?e.dictCategory&&e.dictName?`-${e.name} {dict.${e.dictCategory}.${e.dictName}}`:null:"port"===e.type?e.portName?`-${e.name} {port.${e.portName}}`:null:void 0!==e.defaultValue&&null!==e.defaultValue&&""!==e.defaultValue?`-${e.name} ${e.defaultValue}`:null)).filter((e=>null!==e)).join(" "):"";var a;B.value.parameter=e}),0)},Z=()=>{B.value.parameterList.push({name:"",type:"string"}),Q()};l((async()=>{J(),await(async()=>{try{const e=await E();200===e.code&&(Y.value=e.data.list)}catch(e){}})(),await(async()=>{try{const e=await F("",1,1e3);200===e.code&&(G.value=e.data.list)}catch(e){}})(),q.id&&await te(q.id)}));const ee=a("");(()=>{const e=localStorage.getItem("plugin_key");ee.value=e})();const ae=a(!1),le=a("basic"),te=async e=>{try{const l=await z(e);if(200===l.code){const e=l.data;if(B.value.name=e.name,B.value.version=e.version,B.value.module=e.module,B.value.parameter=e.parameter,B.value.help=e.help,B.value.introduction=e.introduction,K.value=e.source,ae.value=e.isSystem,e.parameterList)try{B.value.parameterList=JSON.parse(e.parameterList)}catch(a){B.value.parameterList=[]}else B.value.parameterList=[]}else t.error(`数据加载失败：${l.message}`)}catch(a){}},oe=a(!1);o((()=>q.id),(async e=>{""===e?J():await te(e)}));const ue=async()=>{if(oe.value=!0,""==B.value.name)return t.error("name 不能为空"),void(oe.value=!1);if(""==B.value.module&&"scan"==q.tp)return t.error("module 不能为空"),void(oe.value=!1);if(!ae.value&&""==K.value)return t.error("源码 不能为空"),void(oe.value=!1);try{const e=JSON.stringify(B.value.parameterList);505==(await D(q.id,B.value.name,B.value.version,B.value.module,B.value.parameter,B.value.help,B.value.introduction,K.value,ee.value,e,q.tp,q.hash)).code&&localStorage.removeItem("plugin_key"),q.closeDialog(),q.getList()}catch(e){t.error("保存失败，请稍后再试。")}finally{oe.value=!1}};return(e,a)=>(u(),r(i(C),{model:B.value,rules:O.value,"label-width":"100px"},{default:d((()=>[n(i(N),{modelValue:le.value,"onUpdate:modelValue":a[7]||(a[7]=e=>le.value=e)},{default:d((()=>[n(i(j),{label:i(S)("plugin.basicInfo"),name:"basic"},{default:d((()=>[n(i(x),{gutter:20},{default:d((()=>[n(i(w),{span:12},{default:d((()=>[n(i(L),{label:i(S)("plugin.name"),prop:"name"},{default:d((()=>[n(i(p),{modelValue:B.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value.name=e),disabled:ae.value},null,8,["modelValue","disabled"])])),_:1},8,["label"])])),_:1}),"scan"==q.tp?(u(),r(i(w),{key:0,span:12},{default:d((()=>[n(i(L),{label:i(S)("plugin.module"),prop:"module"},{default:d((()=>[n(i(U),{modelValue:B.value.module,"onUpdate:modelValue":a[1]||(a[1]=e=>B.value.module=e),disabled:ae.value},{default:d((()=>[(u(!0),s(c,null,m(W.value,(e=>(u(),r(i(k),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1},8,["label"])])),_:1})):v("",!0),n(i(w),{span:12},{default:d((()=>[n(i(L),{label:i(S)("plugin.version"),prop:"version"},{default:d((()=>[n(i(p),{modelValue:B.value.version,"onUpdate:modelValue":a[2]||(a[2]=e=>B.value.version=e),disabled:ae.value},null,8,["modelValue","disabled"])])),_:1},8,["label"])])),_:1}),"scan"==q.tp?(u(),r(i(w),{key:1,span:12},{default:d((()=>[n(i(L),{label:i(S)("plugin.help"),prop:"help"},{default:d((()=>[n(i(p),{modelValue:B.value.help,"onUpdate:modelValue":a[3]||(a[3]=e=>B.value.help=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1})):v("",!0),n(i(w),{span:24},{default:d((()=>[n(i(L),{label:i(S)("plugin.introduction"),prop:"introduction"},{default:d((()=>[n(i(p),{modelValue:B.value.introduction,"onUpdate:modelValue":a[4]||(a[4]=e=>B.value.introduction=e)},null,8,["modelValue"])])),_:1},8,["label"])])),_:1}),"scan"==q.tp?(u(),r(i(w),{key:2,span:24},{default:d((()=>[n(i(L),{label:i(S)("plugin.parameterConfig")},{default:d((()=>[n(i(x),{gutter:20},{default:d((()=>[(u(!0),s(c,null,m(B.value.parameterList,((e,a)=>(u(),r(i(w),{key:a,span:24,style:{"margin-bottom":"16px"}},{default:d((()=>[V("div",H,[n(i($),{size:10,style:{width:"100%"}},{default:d((()=>[n(i(L),{prop:`parameterList.${a}.name`,style:{"margin-bottom":"0"}},{default:d((()=>[n(i(p),{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:i(S)("plugin.parameterName"),style:{width:"120px"},onInput:Q},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["prop"]),n(i(L),{prop:`parameterList.${a}.type`,style:{"margin-bottom":"0"}},{default:d((()=>[n(i(U),{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,placeholder:i(S)("plugin.parameterType"),style:{width:"90px"},onChange:e=>(e=>{const a=B.value.parameterList[e];a.defaultValue=void 0,a.dictCategory=void 0,a.dictName=void 0,a.portName=void 0,Q()})(a)},{default:d((()=>[n(i(k),{label:"string",value:"string"}),n(i(k),{label:"bool",value:"bool"}),n(i(k),{label:"dict",value:"dict"}),n(i(k),{label:"port",value:"port"})])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"])])),_:2},1032,["prop"]),"string"===e.type||"bool"===e.type?(u(),r(i(L),{key:0,prop:`parameterList.${a}.defaultValue`,style:{"margin-bottom":"0"}},{default:d((()=>["bool"===e.type?(u(),r(i(U),{key:0,modelValue:e.defaultValue,"onUpdate:modelValue":a=>e.defaultValue=a,placeholder:i(S)("plugin.defaultValue"),style:{width:"90px"},onChange:Q},{default:d((()=>[n(i(k),{label:"true",value:"true"}),n(i(k),{label:"false",value:"false"})])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):(u(),r(i(p),{key:1,modelValue:e.defaultValue,"onUpdate:modelValue":a=>e.defaultValue=a,placeholder:i(S)("plugin.defaultValue"),style:{width:"120px"},onInput:Q},null,8,["modelValue","onUpdate:modelValue","placeholder"]))])),_:2},1032,["prop"])):v("",!0),"dict"===e.type?(u(),s(c,{key:1},[n(i(L),{prop:`parameterList.${a}.dictCategory`,style:{"margin-bottom":"0"}},{default:d((()=>[n(i(U),{modelValue:e.dictCategory,"onUpdate:modelValue":a=>e.dictCategory=a,placeholder:i(S)("plugin.category"),style:{width:"120px"},filterable:"",onChange:e=>(e=>{B.value.parameterList[e].dictName=void 0,Q()})(a)},{default:d((()=>[(u(!0),s(c,null,m(Y.value,(e=>(u(),r(i(k),{key:e.id,label:e.category||e.name,value:e.category||e.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onChange"])])),_:2},1032,["prop"]),n(i(L),{prop:`parameterList.${a}.dictName`,style:{"margin-bottom":"0"}},{default:d((()=>[n(i(U),{modelValue:e.dictName,"onUpdate:modelValue":a=>e.dictName=a,placeholder:i(S)("plugin.dictName"),style:{width:"120px"},filterable:"",disabled:!e.dictCategory,onChange:Q},{default:d((()=>{return[(u(!0),s(c,null,m((a=e.dictCategory,a?Y.value.filter((e=>(e.category||e.name)===a)):[]),(e=>(u(),r(i(k),{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))];var a})),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])])),_:2},1032,["prop"])],64)):v("",!0),"port"===e.type?(u(),r(i(L),{key:2,prop:`parameterList.${a}.portName`,style:{"margin-bottom":"0"}},{default:d((()=>[n(i(U),{modelValue:e.portName,"onUpdate:modelValue":a=>e.portName=a,placeholder:i(S)("plugin.portName"),style:{width:"150px"},filterable:"",onChange:Q},{default:d((()=>[(u(!0),s(c,null,m(G.value,(e=>(u(),r(i(k),{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["prop"])):v("",!0),n(i(b),{icon:i(_),type:"danger",circle:"",size:"small",onClick:e=>(e=>{B.value.parameterList.splice(e,1),Q()})(a)},null,8,["icon","onClick"])])),_:2},1024)])])),_:2},1024)))),128)),n(i(w),{span:24,style:{"margin-top":"10px"}},{default:d((()=>[n(i(b),{icon:i(g),style:{width:"100%"},onClick:Z},{default:d((()=>[y(f(i(S)("plugin.addParameter")),1)])),_:1},8,["icon"])])),_:1})])),_:1})])),_:1},8,["label"])])),_:1})):v("",!0),"scan"==q.tp?(u(),r(i(w),{key:3,span:24},{default:d((()=>[n(i(L),{label:i(S)("plugin.parameter"),prop:"parameter"},{default:d((()=>[n(i(p),{modelValue:B.value.parameter,"onUpdate:modelValue":a[5]||(a[5]=e=>B.value.parameter=e),type:"textarea",rows:3,readonly:"",style:{"background-color":"#f5f5f5"}},null,8,["modelValue"]),V("div",T,f(i(S)("plugin.parameterTip")),1)])),_:1},8,["label"])])),_:1})):v("",!0)])),_:1})])),_:1},8,["label"]),ae.value?v("",!0):(u(),r(i(j),{key:0,label:i(S)("plugin.sourceCode"),name:"source"},{default:d((()=>[V("div",M,[n(i(I),{modelValue:K.value,"onUpdate:modelValue":a[6]||(a[6]=e=>K.value=e),class:"code-editor",autofocus:!0,"indent-with-tab":!0,"tab-size":2,extensions:X,disabled:ae.value},null,8,["modelValue","disabled"])])])),_:1},8,["label"]))])),_:1},8,["modelValue"]),V("div",R,[n(i(b),{onClick:q.closeDialog},{default:d((()=>[y(f(i(S)("common.cancel")),1)])),_:1},8,["onClick"]),n(i(b),{type:"primary",onClick:ue,loading:oe.value},{default:d((()=>[y(f(i(S)("plugin.save")),1)])),_:1},8,["loading"])])])),_:1},8,["model","rules"]))}}),[["__scopeId","data-v-0bc28175"]]);export{q as default};
