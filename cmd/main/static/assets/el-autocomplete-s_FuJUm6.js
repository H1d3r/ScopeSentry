import{a1 as e,a2 as a,aW as t,a4 as l,a7 as s,bv as o,a5 as u,bt as n,d as i,cr as r,aC as p,bd as d,aa as v,r as c,aU as f,N as g,aJ as m,H as b,o as h,i as y,w as $,f as x,n as S,a as w,aK as A,e as k,E as F,c as C,ab as _,C as B,aS as E,F as I,S as K,z as T,t as W,A as N,aM as R,ag as j,ah as H,bT as U,ac as V,a8 as q,bx as O,aj as z}from"./index-D9UQcSFE.js";import{u as L,E as M}from"./el-popper-CI0yhH6M.js";import{d as P}from"./debounce-CgKOJkOb.js";const D=e({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:a(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:a([Function,Array]),default:t},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:L.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String}),J={[l]:e=>s(e),[o]:e=>s(e),[u]:e=>s(e),focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,select:e=>n(e)},G=["aria-expanded","aria-owns"],Q={key:0},X=["id","aria-selected","onClick"],Y="ElAutocomplete",Z=i({name:Y,inheritAttrs:!1});const ee=z(V(i({...Z,props:D,emits:J,setup(e,{expose:a,emit:t}){const s=e,n=r(),i=p(),V=d(),z=v("autocomplete"),L=c(),D=c(),J=c(),Z=c();let ee=!1,ae=!1;const te=c([]),le=c(-1),se=c(""),oe=c(!1),ue=c(!1),ne=c(!1),ie=f(),re=g((()=>i.style)),pe=g((()=>(te.value.length>0||ne.value)&&oe.value)),de=g((()=>!s.hideLoading&&ne.value)),ve=g((()=>L.value?Array.from(L.value.$el.querySelectorAll("input")):[])),ce=()=>{pe.value&&(se.value=`${L.value.$el.offsetWidth}px`)},fe=()=>{le.value=-1},ge=P((async e=>{if(ue.value)return;const a=e=>{ne.value=!1,ue.value||(q(e)?(te.value=e,le.value=s.highlightFirstItem?0:-1):O(Y,"autocomplete suggestions must be an array"))};if(ne.value=!0,q(s.fetchSuggestions))a(s.fetchSuggestions);else{const t=await s.fetchSuggestions(e,a);q(t)&&a(t)}}),s.debounce),me=e=>{const a=!!e;if(t(o,e),t(l,e),ue.value=!1,oe.value||(oe.value=a),!s.triggerOnFocus&&!e)return ue.value=!0,void(te.value=[]);ge(e)},be=e=>{var a;V.value||("INPUT"!==(null==(a=e.target)?void 0:a.tagName)||ve.value.includes(document.activeElement))&&(oe.value=!0)},he=e=>{t(u,e)},ye=e=>{ae?ae=!1:(oe.value=!0,t("focus",e),s.triggerOnFocus&&!ee&&ge(String(s.modelValue)))},$e=e=>{setTimeout((()=>{var a;(null==(a=J.value)?void 0:a.isFocusInsideContent())?ae=!0:(oe.value&&Ae(),t("blur",e))}))},xe=()=>{oe.value=!1,t(l,""),t("clear")},Se=async()=>{pe.value&&le.value>=0&&le.value<te.value.length?ke(te.value[le.value]):s.selectWhenUnmatched&&(t("select",{value:s.modelValue}),te.value=[],le.value=-1)},we=e=>{pe.value&&(e.preventDefault(),e.stopPropagation(),Ae())},Ae=()=>{oe.value=!1},ke=async e=>{t(o,e[s.valueKey]),t(l,e[s.valueKey]),t("select",e),te.value=[],le.value=-1},Fe=e=>{if(!pe.value||ne.value)return;if(e<0)return void(le.value=-1);e>=te.value.length&&(e=te.value.length-1);const a=D.value.querySelector(`.${z.be("suggestion","wrap")}`),t=a.querySelectorAll(`.${z.be("suggestion","list")} li`)[e],l=a.scrollTop,{offsetTop:s,scrollHeight:o}=t;s+o>l+a.clientHeight&&(a.scrollTop+=o),s<l&&(a.scrollTop-=o),le.value=e,L.value.ref.setAttribute("aria-activedescendant",`${ie.value}-item-${le.value}`)};return m(Z,(()=>{pe.value&&Ae()})),b((()=>{L.value.ref.setAttribute("role","textbox"),L.value.ref.setAttribute("aria-autocomplete","list"),L.value.ref.setAttribute("aria-controls","id"),L.value.ref.setAttribute("aria-activedescendant",`${ie.value}-item-${le.value}`),ee=L.value.ref.hasAttribute("readonly")})),a({highlightedIndex:le,activated:oe,loading:ne,inputRef:L,popperRef:J,suggestions:te,handleSelect:ke,handleKeyEnter:Se,focus:()=>{var e;null==(e=L.value)||e.focus()},blur:()=>{var e;null==(e=L.value)||e.blur()},close:Ae,highlight:Fe}),(e,a)=>(h(),y(w(M),{ref_key:"popperRef",ref:J,visible:w(pe),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[w(z).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${w(z).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ce,onHide:fe},{content:$((()=>[x("div",{ref_key:"regionRef",ref:D,class:S([w(z).b("suggestion"),w(z).is("loading",w(de))]),style:A({[e.fitInputWidth?"width":"minWidth"]:se.value,outline:"none"}),role:"region"},[k(w(F),{id:w(ie),tag:"ul","wrap-class":w(z).be("suggestion","wrap"),"view-class":w(z).be("suggestion","list"),role:"listbox"},{default:$((()=>[w(de)?(h(),C("li",Q,[_(e.$slots,"loading",{},(()=>[k(w(B),{class:S(w(z).is("loading"))},{default:$((()=>[k(w(E))])),_:1},8,["class"])]))])):(h(!0),C(I,{key:1},K(te.value,((a,t)=>(h(),C("li",{id:`${w(ie)}-item-${t}`,key:t,class:S({highlighted:le.value===t}),role:"option","aria-selected":le.value===t,onClick:e=>ke(a)},[_(e.$slots,"default",{item:a},(()=>[T(W(a[e.valueKey]),1)]))],10,X)))),128))])),_:3},8,["id","wrap-class","view-class"])],6)])),default:$((()=>[x("div",{ref_key:"listboxRef",ref:Z,class:S([w(z).b(),e.$attrs.class]),style:A(w(re)),role:"combobox","aria-haspopup":"listbox","aria-expanded":w(pe),"aria-owns":w(ie)},[k(w(N),R({ref_key:"inputRef",ref:L},w(n),{clearable:e.clearable,disabled:w(V),name:e.name,"model-value":e.modelValue,onInput:me,onChange:he,onFocus:ye,onBlur:$e,onClear:xe,onKeydown:[a[0]||(a[0]=j(H((e=>Fe(le.value-1)),["prevent"]),["up"])),a[1]||(a[1]=j(H((e=>Fe(le.value+1)),["prevent"]),["down"])),j(Se,["enter"]),j(Ae,["tab"]),j(we,["esc"])],onMousedown:be}),U({_:2},[e.$slots.prepend?{name:"prepend",fn:$((()=>[_(e.$slots,"prepend")]))}:void 0,e.$slots.append?{name:"append",fn:$((()=>[_(e.$slots,"append")]))}:void 0,e.$slots.prefix?{name:"prefix",fn:$((()=>[_(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:$((()=>[_(e.$slots,"suffix")]))}:void 0]),1040,["clearable","disabled","name","model-value","onKeydown"])],14,G)])),_:3},8,["visible","placement","popper-class","teleported","transition"]))}}),[["__file","autocomplete.vue"]]));export{ee as E};
