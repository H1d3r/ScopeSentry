import{u as e,F as s}from"./useForm-D6ccTQpk.js";import{d as a,b as t,V as o,q as r,u as l,s as n,e as i,F as u,G as d,r as m,H as c,a9 as p,a as f,o as g,i as w,J as R,l as v}from"./index-D9UQcSFE.js";import{E as b}from"./el-checkbox-t7oy-lx0.js";import{l as y,g as h,a as I}from"./index-CYMomMq1.js";import{u as P}from"./useValidator-BiEZIaNj.js";const j=a({__name:"LoginForm",emits:["to-register"],setup(a,{emit:j}){const{required:x}=P(),k=t(),E=o(),D=r(),{currentRoute:F,addRoute:V,push:q}=l(),{t:A}=v(),L={username:[x()],password:[x()]},_=n([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>i("h2",{class:"text-2xl font-bold text-center w-[100%]"},[A("login.login")])}}},{field:"username",label:A("login.username"),component:"Input",colProps:{span:24}},{field:"password",label:A("login.password"),component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"}}},{field:"tool",colProps:{span:24},formItemProps:{slots:{default:()=>i(u,null,[i("div",{class:"flex justify-between items-center w-[100%]"},[i(b,{modelValue:M.value,"onUpdate:modelValue":e=>M.value=e,label:A("login.remember"),size:"small"},null)])])}}},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return i(u,null,[i("div",{class:"w-[100%]"},[i(d,{loading:G.value,type:"primary",class:"w-[100%]",onClick:J},(s=e=A("login.login"),"function"==typeof s||"[object Object]"===Object.prototype.toString.call(s)&&!R(s)?e:{default:()=>[e]}))])]);var s}}}}]),M=m(E.getRememberMe);c((()=>{(()=>{const e=E.getLoginInfo;if(e){const{username:s,password:a}=e;C({username:s,password:a})}})()}));const{formRegister:S,formMethods:z}=e(),{getFormData:O,getElFormExpose:U,setValues:C}=z,G=m(!1),H=m("");p((()=>F.value),(e=>{var s;H.value=null==(s=null==e?void 0:e.query)?void 0:s.redirect}),{immediate:!0});const J=async()=>{const e=await U();await(null==e?void 0:e.validate((async e=>{if(e){G.value=!0;const e=await O();try{const s=await y(e);s&&(f(M)?E.setLoginInfo({username:e.username,password:e.password}):E.setLoginInfo(void 0),E.setRememberMe(f(M)),E.setToken(s.data.access_token),E.setUsername(e.username),k.getDynamicRouter?N():(await D.generateRoutes("static").catch((()=>{})),D.getAddRouters.forEach((e=>{V(e)})),D.setIsAddRouters(!0),q({path:H.value||D.addRouters[0].path})))}finally{G.value=!1}}})))},N=async()=>{const e={roleName:(await O()).username},s=k.getDynamicRouter&&k.getServerDynamicRouter?await h(e):await I(e);if(s){const e=s.data||[];E.setRoleRouters(e),k.getDynamicRouter&&k.getServerDynamicRouter?await D.generateRoutes("server",e).catch((()=>{})):await D.generateRoutes("frontEnd",e).catch((()=>{})),D.getAddRouters.forEach((e=>{V(e)})),D.setIsAddRouters(!0),q({path:H.value||D.addRouters[0].path})}};return(e,a)=>(g(),w(f(s),{schema:_,rules:L,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:f(S)},null,8,["schema","onRegister"]))}});export{j as _};
