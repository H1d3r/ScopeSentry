import{P as e,g as a,U as t}from"./PanelGroup-Badcnuit.js";import{d as l,r as s,s as o,v as r,x as n,y as m,o as i,c as d,e as u,w as p,a as c,f,t as v,i as g,z as h,j as _,A as b,B as y,F as x,l as j,_ as k}from"./index-D9UQcSFE.js";import{E as w,a as N}from"./el-col-CXXou3fy.js";import{E as S}from"./el-card-DCo43hKN.js";import{E as V}from"./el-progress-DiltV8uQ.js";import{E as A}from"./el-text-nFwZ0AHD.js";import"./el-tooltip-l0sNRNKZ.js";import{E as C}from"./el-popper-CI0yhH6M.js";import{E,a as U}from"./el-form-ClIvQroC.js";import{_ as F}from"./Table.vue_vue_type_script_lang-BwmIaq25.js";import{E as I}from"./el-tag-kYKN7H0G.js";import{_ as z}from"./Dialog.vue_vue_type_style_index_0_lang-DeqRaDiv.js";import{g as P}from"./index-Ctb9eivg.js";import{g as T}from"./index-BoLqEwEd.js";import{c as B}from"./index-BdT7lvrf.js";import"./el-skeleton-item-C66X8I82.js";import"./CountTo.vue_vue_type_script_setup_true_lang-dedm4gM9.js";import"./index-BRGVtAVt.js";import"./castArray-Bow0xsjh.js";import"./el-table-column-Bzxs424x.js";import"./index-BOy3-hgS.js";import"./debounce-CgKOJkOb.js";import"./el-checkbox-t7oy-lx0.js";import"./isArrayLikeObject-CT7DS3OS.js";import"./raf-B6O9U2CX.js";import"./el-pagination-C9wpkp8F.js";import"./el-select-Dv9vCEmJ.js";import"./strings-CBvC00KA.js";import"./useInput-DYqoIpgX.js";import"./el-image-viewer-gZ5dQPUY.js";import"./el-empty-CBFdbnl8.js";import"./tsxHelper-Dc2XHH9E.js";import"./el-dropdown-item-C-MClRcm.js";import"./refs-wNcffJKd.js";import"./index-BGn7iVRV.js";import"./el-dialog-Dx-yfAYV.js";const M={class:"flex flex-col gap-2"},R=k(l({__name:"Analysis",setup(l){const{t:k}=j(),R=s(!0),D=o([{field:"name",label:k("node.nodeName")},{field:"running",label:k("node.taskCount"),formatter:(e,a,t)=>r(I,{round:!0,effect:"dark"},(()=>t))},{field:"finished",label:k("node.finished"),formatter:(e,a,t)=>r(I,{round:!0,effect:"dark"},(()=>t))},{field:"state",label:k("node.nodeStatus"),formatter:(e,a,t)=>r(I,{type:"1"===t?"success":"2"===t?"warning":"danger",effect:"dark"},(()=>k("1"==t?"node.statusRun":"2"==t?"node.statusStop":"node.statusError")))}]),H=o([{field:"name",label:k("task.taskName")},{field:"taskNum",label:k("task.taskCount"),formatter:(e,a,t)=>r(I,{round:!0,effect:"dark"},(()=>t))},{field:"progress",label:k("task.taskProgress"),formatter:(e,a,t)=>r(V,{percentage:t,type:"line",striped:!0,status:t<100?"":"success",stripedFlow:t<100})},{field:"creatTime",label:k("task.createTime")}]),L=o([{field:"name",label:k("node.nodeName")},{field:"cpuNum",label:k("node.nodeUsageCpu"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),r(V,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<=80?"#fe9900":"#df2800"})}},{field:"memNum",label:k("node.nodeUsageMemory"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),r(V,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<80?"#fe9900":"#df2800"})}}]),O=o([{field:"name",label:k("common.name")},{field:"cversion",label:k("common.cversion")},{field:"lversion",label:k("common.lversion"),formatter:(e,a,t)=>{if(e.cversion!=e.lversion){ee.value=!0;const a=e.msg.split("\\n");let l="";return a.forEach((e=>{l+=`<div>${e}</div>`})),r(C,{placement:"top",content:l,rawContent:!0},[r(A,{type:"danger"},t)])}return r(A,t)}}]);let q=s([]);const G=s([]),K=async()=>{try{const e=await P();e&&e.data&&Array.isArray(e.data.list)&&(G.value=e.data.list.map((e=>({name:e.name,running:e.running,state:e.state,finished:e.finished,cpuNum:e.cpuNum,memNum:e.memNum}))),q.value=o(e.data.list.map((e=>({name:e.name,cpuNum:e.cpuNum,memNum:e.memNum})))))}catch(e){}finally{R.value=!1}},Z=s([]),$=async()=>{const e=await T("",1,10);Z.value=o(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},J=s([]),Q=async()=>{await Promise.all([K(),$()]),R.value=!1};(async()=>{const e=await a();J.value=o(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),Q();const W=setInterval(Q,1e4);n((()=>{clearInterval(W)}));const X=s(""),Y=async()=>{if(X.value){200==(await B(X.value)).code&&(localStorage.setItem("plugin_key",X.value),le.value=!1,te.value=!0)}},ee=s(!1),ae=s({server:"https://github.com/Autumn-27/ScopeSentry/archive/refs/heads/main.zip",scan:""}),te=s(!1),le=s(!1);async function se(){const e=localStorage.getItem("plugin_key");505==(await t(ae.value.server,ae.value.scan,e)).code&&localStorage.removeItem("plugin_key")}return(a,t)=>{const l=m("BaseButton");return i(),d(x,null,[u(e),u(c(N),{gutter:20,justify:"space-between"},{default:p((()=>[u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(S),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,v(c(k)("dashboard.nodeInfo")),1)])),default:p((()=>[u(c(F),{columns:D,data:G.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(S),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,v(c(k)("dashboard.taskInfo")),1)])),default:p((()=>[u(c(F),{columns:H,data:Z.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(S),{shadow:"hover",class:"mb-25px"},{header:p((()=>[f("div",null,[f("span",null,v(c(k)("node.nodeUsageStatus")),1)])])),default:p((()=>[u(c(F),{columns:L,data:c(q),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(S),{shadow:"hover",class:"mb-25px"},{header:p((()=>[u(c(N),null,{default:p((()=>[u(c(w),{span:12},{default:p((()=>[f("div",null,[f("span",null,v(c(k)("common.version")),1),ee.value?(i(),g(c(A),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[h("*"+v(c(k)("common.updatemsg")),1)])),_:1})):_("",!0)])])),_:1})])),_:1})])),default:p((()=>[u(c(F),{columns:O,data:J.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1}),u(c(z),{modelValue:te.value,"onUpdate:modelValue":t[2]||(t[2]=e=>te.value=e),title:"Update",center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},maxHeight:430},{default:p((()=>[u(c(A),{type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[h("*更新目前只支持docker容器搭建的程序，输入的url地址确保docker内可访问，节点最新版在github中releases的linux版本")])),_:1}),u(c(E),{model:ae.value,"label-width":"120px",class:"upload-form"},{default:p((()=>[u(c(U),{label:"server url"},{default:p((()=>[u(c(b),{modelValue:ae.value.server,"onUpdate:modelValue":t[0]||(t[0]=e=>ae.value.server=e),placeholder:"server url"},null,8,["modelValue"])])),_:1}),u(c(U),{label:"scan url"},{default:p((()=>[u(c(b),{modelValue:ae.value.scan,"onUpdate:modelValue":t[1]||(t[1]=e=>ae.value.scan=e),placeholder:"scan url(https://github.com/Autumn-27/ScopeSentry-Scan/releases/download/vx.x.x/ScopeSentry-Scan_linux_amd64_vx.x.x.zip)"},null,8,["modelValue"])])),_:1}),u(c(U),null,{default:p((()=>[u(c(y),{type:"primary",onClick:se},{default:p((()=>[h("Submit")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),u(c(z),{modelValue:le.value,"onUpdate:modelValue":t[4]||(t[4]=e=>le.value=e),title:c(k)("plugin.key"),center:"",width:"30%",style:{"max-width":"400px",height:"200px"}},{default:p((()=>[f("div",M,[u(c(C),{class:"item",effect:"dark",content:c(k)("plugin.keyMsg"),placement:"top"},{default:p((()=>[u(c(b),{modelValue:X.value,"onUpdate:modelValue":t[3]||(t[3]=e=>X.value=e)},null,8,["modelValue"])])),_:1},8,["content"]),u(l,{onClick:Y,type:"primary",class:"w-full"},{default:p((()=>[h("确定")])),_:1})])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-72a960be"]]);export{R as default};
