import{d as e,s as a,N as l,r as t,H as o,o as s,c as r,e as d,w as u,a as n,A as i,B as g,z as p,t as c,F as m,l as f,M as h}from"./index-D9UQcSFE.js";import{E as j}from"./el-divider-LTX6_6vl.js";import{a as v,E as _}from"./el-form-ClIvQroC.js";import{a as b,E as x}from"./el-col-CXXou3fy.js";import{b as y,u as V,c as k}from"./index-VJa0MK9d.js";import{a as w}from"./index-Ctb9eivg.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-DeqRaDiv.js";import{i as N}from"./index-BoLqEwEd.js";import P from"./DetailTemplate-DGFzkX8U.js";const D=e({__name:"AddProject",props:{closeDialog:{type:Function},projectid:{},getProjectData:{type:Function},schedule:{type:Boolean}},setup(e){const{t:D}=f();let U=a({name:"",tag:"",logo:"",target:"",ignore:"",scheduledTasks:!1,hour:24,node:[],allNode:!1,duplicates:"None",template:""});const q=e,E=l((()=>{const e={name:[{required:!0,message:D("project.msgProject"),trigger:"blur"}],tag:[{required:!0,message:D("project.msgProjectTag"),trigger:"blur"}],target:[{required:!0,message:D("project.msgProjectScope"),trigger:"blur"}],node:[{required:!1,message:D("task.nodeMsg"),trigger:"blur"}],template:[{required:!0,message:"Please select template",trigger:"blur"}]};return U.scheduledTasks&&(e.node=[{required:!0,message:D("task.nodeMsg"),trigger:"blur"}]),e})),M=t(!1),F=t(),z=t(!1),A=t(!1);t(!1);const B=t(!1),R=a([]),L=a([]),S=async()=>{L.length=0;const e=await N("",1,1e3);e.data.list.length>0&&e.data.list.forEach((e=>{L.push({value:e.id,label:e.name})}))};o((()=>{(async()=>{if(""!=q.projectid){A.value=!0;const e=await k(q.projectid);U.name=e.data.name,U.tag=e.data.tag,U.target=e.data.target,U.logo=e.data.logo,U.scheduledTasks=e.data.scheduledTasks,U.hour=e.data.hour,U.allNode=e.data.allNode,U.node=e.data.node,U.duplicates=e.data.duplicates,U.ignore=e.data.ignore,U.template=e.data.template,A.value=!1}})(),(async()=>{const e=await w();e.data.list.length>0?(B.value=!1,e.data.list.forEach((e=>{R.push({value:e,label:e})}))):(B.value=!0,h.warning(D("node.onlineNodeMsg")))})(),S()}));const C=t("");const G=t(!1),H=()=>{G.value=!1};return(e,a)=>(s(),r(m,null,[d(n(_),{model:n(U),"label-width":"auto",rules:E.value,"status-icon":"",ref_key:"ruleFormRef",ref:F,loading:A.value},{default:u((()=>[d(n(v),{label:n(D)("project.projectName"),prop:"name"},{default:u((()=>[d(n(i),{modelValue:n(U).name,"onUpdate:modelValue":a[0]||(a[0]=e=>n(U).name=e),placeholder:n(D)("project.msgProject")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:"TAG",prop:"tag"},{default:u((()=>[d(n(i),{modelValue:n(U).tag,"onUpdate:modelValue":a[1]||(a[1]=e=>n(U).tag=e),placeholder:n(D)("project.msgProjectTag")},null,8,["modelValue","placeholder"])])),_:1}),d(n(v),{label:n(D)("project.projectScope"),prop:"target"},{default:u((()=>[d(n(i),{modelValue:n(U).target,"onUpdate:modelValue":a[2]||(a[2]=e=>n(U).target=e),placeholder:n(D)("task.msgTarget"),type:"textarea",autosize:{minRows:6,maxRows:15}},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:n(D)("task.ignore"),prop:"ignore"},{default:u((()=>[d(n(i),{modelValue:n(U).ignore,"onUpdate:modelValue":a[3]||(a[3]=e=>n(U).ignore=e),placeholder:n(D)("task.ignoreMsg"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:"Logo",prop:"logo"},{default:u((()=>[d(n(i),{modelValue:n(U).logo,"onUpdate:modelValue":a[4]||(a[4]=e=>n(U).logo=e),placeholder:"http(s)://xxxxx.xx"},null,8,["modelValue"])])),_:1}),d(n(j)),d(n(b),null,{default:u((()=>[d(n(x),{span:2,offset:12},{default:u((()=>[d(n(v),null,{default:u((()=>[d(n(g),{type:"primary",onClick:a[5]||(a[5]=e=>(async e=>{M.value=!0,e&&(await e.validate((async(e,a)=>{if(e)if(""==q.projectid)try{200===(await y(z.value,U.name,U.tag,U.target,U.logo,U.scheduledTasks,U.hour,U.allNode,U.node,U.duplicates,U.ignore,U.template)).code&&q.closeDialog()}finally{M.value=!1}else try{200===(await V(z.value,q.projectid,U.name,U.tag,U.target,U.logo,U.scheduledTasks,U.hour,U.allNode,U.node,U.duplicates,U.ignore,U.template)).code&&q.closeDialog()}finally{M.value=!1}else M.value=!1})),q.getProjectData(1,50))})(F.value)),loading:M.value},{default:u((()=>[p(c(n(D)("task.save")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","loading"]),d(n(T),{modelValue:G.value,"onUpdate:modelValue":a[6]||(a[6]=e=>G.value=e),title:n(""),center:"",fullscreen:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:u((()=>[d(P,{closeDialog:H,getList:S,id:C.value},null,8,["id"])])),_:1},8,["modelValue","title"])],64))}});export{D as _};
