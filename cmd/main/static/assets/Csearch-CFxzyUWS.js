import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-Bjl2qjEM.js";import{d as a,dE as l,s as t,r as s,a9 as o,o as i,c as r,e as n,w as c,f as p,a as d,B as u,t as m,z as v,F as g,S as h,C as f,i as y,j as x,U as _,n as b,l as j,K as k,M as w,_ as S}from"./index-D9UQcSFE.js";import{a as C,E as V}from"./el-col-CXXou3fy.js";import{E as F,a as H}from"./el-table-column-Bzxs424x.js";import"./el-checkbox-t7oy-lx0.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-CI0yhH6M.js";import{E}from"./el-tag-kYKN7H0G.js";import{E as $}from"./el-text-nFwZ0AHD.js";import{E as A}from"./el-divider-LTX6_6vl.js";import{E as T}from"./el-autocomplete-s_FuJUm6.js";import{b as L,E as U,a as z}from"./el-dropdown-item-C-MClRcm.js";import{E as D,b as I}from"./el-select-Dv9vCEmJ.js";/* empty css                */import{E as N}from"./el-tree-select-Dh71Q0tt.js";import{E as B}from"./el-switch-B9n_0JFR.js";import{_ as O}from"./Dialog.vue_vue_type_style_index_0_lang-DeqRaDiv.js";import{u as W}from"./useIcon-Dp8bmm5Q.js";import{_ as K}from"./exportData.vue_vue_type_script_setup_true_lang-CfNc9BIv.js";import{A as P}from"./index-Cjpub395.js";import{_ as R}from"./AddTask.vue_vue_type_script_setup_true_lang-DVJyRDoU.js";import"./el-card-DCo43hKN.js";import"./index-BOy3-hgS.js";import"./debounce-CgKOJkOb.js";import"./isArrayLikeObject-CT7DS3OS.js";import"./raf-B6O9U2CX.js";import"./el-pagination-C9wpkp8F.js";import"./castArray-Bow0xsjh.js";import"./refs-wNcffJKd.js";import"./strings-CBvC00KA.js";import"./useInput-DYqoIpgX.js";import"./index-OZcygSCV.js";import"./el-dialog-Dx-yfAYV.js";import"./el-tab-pane-CbJd8YfH.js";import"./el-form-ClIvQroC.js";/* empty css                 */import"./el-radio-group-Bkh-faiF.js";import"./el-space-B2KBkAnB.js";/* empty css                          */import"./index-BRGVtAVt.js";import"./Table.vue_vue_type_script_lang-BwmIaq25.js";import"./el-image-viewer-gZ5dQPUY.js";import"./el-empty-CBFdbnl8.js";import"./tsxHelper-Dc2XHH9E.js";import"./index-BGn7iVRV.js";import"./useTable-CbxTkDDT.js";import"./el-virtual-list-x2q1m_0t.js";import"./el-select-v2-gRo57qYg.js";import"./el-drawer-bw6GB9YA.js";import"./index-Ctb9eivg.js";import"./index-BoLqEwEd.js";import"./DetailTemplate-DGFzkX8U.js";import"./index-BdT7lvrf.js";import"./index-7Bo_TG81.js";import"./index-DRPh3UHe.js";import"./index-VJa0MK9d.js";const q={class:"search-toolbar"},J={class:"search-input-container"},M={style:{float:"left"}},G={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Q={class:"task-select-container"},X={class:"project-select-container"},Y={class:"custom-dropdown"},Z={key:0,class:"dropdown-item"},ee={class:"label-text"},ae={class:"label-text"},le={key:0,class:"segment-container"},te={class:"segment-control"},se={class:"flex gap-2",style:{"flex-wrap":"wrap"}},oe={style:{color:"#888"}},ie={style:{"font-weight":"bold",color:"#333333"}},re={style:{color:"#888"}},ne=["src","alt"],ce=S(a({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},taskList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function},crudSchemas:{},statisticsHidden:{type:Boolean},changeStatisticsHidden:{type:Function},searchResultCount:{},sensitiveAllNumber:{},activeSegment:{},setActiveSegment:{type:Function},getFilter:{type:Function},iconData:{}},emits:["update-column-visibility"],setup(a,{emit:S}){const{t:ce}=j(),{query:pe}=l(),de=a,ue=t([...de.searchKeywordsData]),me={keyword:"task",example:'task=="test"',explain:ce("searchHelp.taskName")};ue.push(me),ue.push({keyword:"tag",example:'tag=="test"',explain:"find tags"});const ve=[{operator:"=",meaning:ce("searchHelp.like"),value:'=""'},{operator:"!=",meaning:ce("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:ce("searchHelp.equal"),value:'==""'}],ge=[{operator:"&&",meaning:ce("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:ce("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:ce("searchHelp.brackets"),value:"()",logic:"1"}],he=ve.concat(ge),fe=s(!1);(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${de.index}`)||"{}");de.crudSchemas.forEach((a=>{void 0!==e[a.field]&&(a.hidden=e[a.field])}))})(),o((()=>de.crudSchemas),(()=>{(()=>{const e=de.crudSchemas.reduce(((e,a)=>("select"!=a.field&&(e[a.field]=a.hidden),e)),{});localStorage.setItem(`columnConfig_${de.index}`,JSON.stringify(e))})()}),{deep:!0});const ye=()=>{fe.value=!0};function xe(){return{background:"var(--el-fill-color-light)"}}const _e=s(""),be=W({icon:"iconoir:search"}),je=W({icon:"tdesign:chat-bubble-help"}),ke=W({icon:"ri:arrow-drop-down-line"}),we=W({icon:"ph:export-light"}),Se=W({icon:"carbon:data-vis-1"}),Ce=W({icon:"openmoji:delete"}),Ve=W({icon:"carbon:task-complete"}),Fe=s(!1),He=()=>{Fe.value=!0},Ee=s([]),$e=async()=>{const e=await de.getElTableExpose(),a=(null==e?void 0:e.getSelectionRows())||[];return Ee.value=a.map((e=>e.id)),Ee.value},Ae=async()=>{k.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await $e(),await P(Ee.value,de.index),de.getList()})).catch((()=>{w({type:"info",message:"Delete canceled"})}))},Te=s(""),Le=s(!1),Ue=s(!1);let ze=s(!0),De=s(!1),Ie=s(!1);const Ne=(e,a)=>{if(Te.value=e,""==e&&(ze.value=!0,Ie.value=!1,De.value=!1),ze.value){Ie.value&&(e=e.replace(Te.value,"").trim());a(ue.filter((a=>a.keyword.toLowerCase().includes(e.toLowerCase()))))}else if(De.value){const l=e.replace(Te.value,"").trim();a(ve.filter((e=>e.operator.includes(l))))}else if(Ie.value&&e.endsWith(" ")){const l=e.replace(_e.value,"").trim();a(ge.filter((e=>e.operator.includes(l))))}else a([])},Be=e=>{if(e.keyword){let a="";a=Ie.value?Te.value+e.keyword:e.keyword,Te.value=a,_e.value=a,Le.value=!0,ze.value=!1,De.value=!0}else e.logic?(_e.value=`${Te.value}${e.value}`,Te.value=_e.value,ze.value=!0):(_e.value=`${Te.value}${e.value}`,Te.value=_e.value,Ue.value=!0,De.value=!1,Ie.value=!0)},Oe=s(!1),We=s([]),Ke=s([]),Pe=async()=>{const e={project:We.value};e.task=Ke.value,de.handleFilterSearch(_e.value,e)};o((()=>We.value),(e=>{Pe()})),o((()=>Ke.value),(e=>{Pe()}));const Re=s(de.dynamicTags?[...de.dynamicTags]:[]),qe=()=>{const e={};Re.value.forEach((a=>{const[l,t]=a.split("=");l in e?e[l].push(t):e[l]=[t]})),e.project=We.value,de.handleFilterSearch(_e.value,e)};let Je=pe.task;void 0!==Je&&""!==Je&&Re.value.push(`task=${Je}`);const Me=JSON.parse(localStorage.getItem("assetActiveSegment")||"{}");Me&&Me.activeSegment&&de.setActiveSegment&&de.setActiveSegment(Me.activeSegment,!1),qe(),o((()=>de.dynamicTags),(e=>{e?(Re.value=[...e],void 0!==Je&&""!==Je&&Re.value.push(`task=${Je}`)):Re.value=[],qe()}),{immediate:!1});const Ge=S,Qe=s(de.statisticsHidden),Xe=()=>{location.reload()},Ye=W({icon:"icons8:insert-table"}),Ze=W({icon:"flowbite:grid-solid"});function ea(e){de.setActiveSegment&&de.setActiveSegment(e,!0)}const aa=s(!1);let la=ce("task.addTask");const ta=()=>{aa.value=!1},sa=async()=>{await $e(),aa.value=!0};return(a,l)=>(i(),r(g,null,[n(d(e),null,{default:c((()=>[p("div",q,[p("div",J,[n(d(T),{modelValue:_e.value,"onUpdate:modelValue":l[0]||(l[0]=e=>_e.value=e),"fetch-suggestions":Ne,placeholder:d(ce)("form.input"),popperClass:"my-autocomplete",onSelect:Be,class:"search-autocomplete",style:{width:"100%"}},{append:c((()=>[n(d(u),{onClick:ye,text:"",style:{display:"contents"},icon:d(je)},null,8,["icon"])])),default:c((({item:e})=>[p("span",M,m(e.keyword||e.operator),1),p("span",G,m(e.explain||e.meaning),1)])),_:1},8,["modelValue","placeholder"])]),n(d(u),{type:"primary",icon:d(be),onClick:l[1]||(l[1]=e=>a.$props.handleSearch(_e.value)),class:"toolbar-btn"},{default:c((()=>[v(m(d(ce)("form.input")),1)])),_:1},8,["icon"]),n(d(u),{type:"primary",onClick:He,icon:d(we),class:"toolbar-btn"},{default:c((()=>[v(m(d(ce)("asset.export")),1)])),_:1},8,["icon"]),p("div",Q,[n(d(D),{modelValue:Ke.value,"onUpdate:modelValue":l[2]||(l[2]=e=>Ke.value=e),placeholder:d(ce)("task.taskName"),multiple:"",filterable:"","collapse-tags":"","max-collapse-tags":1,class:"task-select",clearable:""},{default:c((()=>[(i(!0),r(g,null,h(a.$props.taskList,(e=>(i(),y(d(I),{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])]),p("div",X,[n(d(N),{loading:Oe.value,modelValue:We.value,"onUpdate:modelValue":l[3]||(l[3]=e=>We.value=e),data:a.$props.projectList,placeholder:d(ce)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1,class:"project-select"},null,8,["loading","modelValue","data","placeholder"])]),n(d(L),{trigger:"click",class:"toolbar-dropdown"},{dropdown:c((()=>[n(d(U),null,{default:c((()=>[n(d(z),{icon:d(Ce),onClick:Ae},{default:c((()=>[v(m(d(ce)("common.delete")),1)])),_:1},8,["icon"]),n(d(z),{icon:d(Ve),onClick:sa},{default:c((()=>[v(m(d(ce)("task.addTask")),1)])),_:1},8,["icon"])])),_:1})])),default:c((()=>[n(d(u),{plain:"",class:"custom-button toolbar-btn"},{default:c((()=>[v(m(d(ce)("common.operation"))+" ",1),n(d(f),{class:"el-icon--right"},{default:c((()=>[n(d(ke))])),_:1})])),_:1})])),_:1}),n(d(L),{class:"toolbar-dropdown"},{dropdown:c((()=>[n(d(U),null,{default:c((()=>[(i(!0),r(g,null,h(a.crudSchemas,((e,a)=>(i(),y(d(z),{key:a},{default:c((()=>["selection"!=e.field?(i(),r("div",Z,[p("span",ee,m(e.label),1),n(d(B),{size:"small",modelValue:e.hidden,"onUpdate:modelValue":a=>e.hidden=a,"active-value":!1,"inactive-value":!0,onChange:a=>(e=>{Ge("update-column-visibility",{field:e.field,hidden:e.hidden})})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):x("",!0)])),_:2},1024)))),128)),"asset"==a.$props.index?(i(),y(d(z),{key:0},{default:c((()=>[p("span",ae,m(d(ce)("asset.Chart")),1),n(d(B),{size:"small",modelValue:Qe.value,"onUpdate:modelValue":l[4]||(l[4]=e=>Qe.value=e),"active-value":!1,"inactive-value":!0,onChange:l[5]||(l[5]=e=>a.changeStatisticsHidden(Qe.value))},null,8,["modelValue"])])),_:1})):x("",!0),n(d(z),{divided:""},{default:c((()=>[n(d(u),{style:{width:"100%"},type:"primary",onClick:Xe},{default:c((()=>[v("Save")])),_:1})])),_:1})])),_:1})])),default:c((()=>[p("div",Y,[n(d(_),{icon:"ant-design:setting-outlined",class:"cursor-pointer"})])])),_:1}),"asset"==a.index?(i(),r("div",le,[p("div",te,[p("div",{class:b(["segment",{active:"tableSegment"===de.activeSegment}]),onClick:l[6]||(l[6]=e=>ea("tableSegment"))},[n(d(f),null,{default:c((()=>[n(d(Ye))])),_:1})],2),p("div",{class:b(["segment",{active:"cardSegment"===de.activeSegment}]),onClick:l[7]||(l[7]=e=>ea("cardSegment"))},[n(d(f),null,{default:c((()=>[n(d(Ze))])),_:1})],2)])])):x("",!0),"SensitiveResult"==a.index?(i(),y(d(u),{key:1,type:"success",onClick:a.$props.openAggregation,icon:d(Se),class:"toolbar-btn"},{default:c((()=>[v(m(d(ce)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):x("",!0)]),n(d(C),{class:"result-info-row"},{default:c((()=>[n(d(V),{span:24},{default:c((()=>[p("div",se,[p("span",oe,m(d(ce)("asset.total")),1),p("span",ie,m(de.searchResultCount),1),p("span",re,m(d(ce)("asset.result")),1),(i(!0),r(g,null,h(Re.value,(e=>(i(),y(d(E),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:a=>function(e){e.includes("task=")&&(Je=""),de.handleClose&&de.handleClose(e)}(e)},{default:c((()=>[e.startsWith("icon=")?(i(),r("img",{key:0,src:"/images/icon/"+e.split("=")[1]+".png",alt:e,style:{width:"20px",height:"20px","vertical-align":"middle"}},null,8,ne)):(i(),r(g,{key:1},[v(m(e),1)],64))])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),n(d(O),{modelValue:fe.value,"onUpdate:modelValue":l[8]||(l[8]=e=>fe.value=e),title:d(ce)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:c((()=>[n(d(C),null,{default:c((()=>[n(d(V),null,{default:c((()=>[n(d($),{tag:"b",size:"small"},{default:c((()=>[v(m(d(ce)("searchHelp.operator")),1)])),_:1}),n(d(A),{direction:"vertical"}),n(d($),{size:"small",type:"danger"},{default:c((()=>[v(m(d(ce)("searchHelp.notice")),1)])),_:1})])),_:1}),n(d(V),{style:{"margin-top":"10px"}},{default:c((()=>[n(d(F),{headerCellStyle:xe,data:d(he)},{default:c((()=>[n(d(H),{prop:"operator",label:d(ce)("searchHelp.operator"),width:"300"},null,8,["label"]),n(d(H),{prop:"meaning",label:d(ce)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),n(d(V),{style:{"margin-top":"15px"}},{default:c((()=>[n(d($),{tag:"b",size:"small"},{default:c((()=>[v(m(d(ce)("searchHelp.keywords")),1)])),_:1})])),_:1}),n(d(V),{style:{"margin-top":"10px"}},{default:c((()=>[n(d(F),{headerCellStyle:xe,data:ue},{default:c((()=>[n(d(H),{prop:"keyword",label:d(ce)("searchHelp.keywords")},null,8,["label"]),n(d(H),{prop:"example",label:d(ce)("searchHelp.example")},null,8,["label"]),n(d(H),{prop:"explain",label:d(ce)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),n(d(O),{modelValue:Fe.value,"onUpdate:modelValue":l[9]||(l[9]=e=>Fe.value=e),title:d(ce)("asset.export"),center:"","max-height":"300",width:"70%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:c((()=>[n(K,{index:a.$props.index,searchParams:_e.value,getFilter:a.$props.getFilter},null,8,["index","searchParams","getFilter"])])),_:1},8,["modelValue","title"]),n(d(O),{modelValue:aa.value,"onUpdate:modelValue":l[10]||(l[10]=e=>aa.value=e),title:d(la),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:c((()=>[n(R,{closeDialog:ta,create:!0,taskid:"",schedule:!1,getList:function(){},tp:a.$props.index+"Source","target-ids":Ee.value,getFilter:a.$props.getFilter,searchParams:_e.value},null,8,["getList","tp","target-ids","getFilter","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-98f01928"]]);export{ce as default};
